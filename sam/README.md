# Deploy lambda - AWS SAM

AWS SAM - Serverless Application Model is an extension of CloudFormations. This tool consists of application
specification and cli tool to support build/deployment/execution of Lambda functions. Templates is an easy way to apply
standards, CICD pipelines, security check across newly created projects. Knowledge of CloudFormation is required to
develop advanced scenarios.

Application is a form of grouping the functions, dbs and all AWS resources used by it. This allows monitoring and
management of whole application at once. Comes in handy for bigger applications and robust systems.

Implementation of Layer was added to showcase how easy it is to add one. 

Folder `tests` was left without changes after generation to show the structure which was generated. During project
initialization template is selected based on which structure is created. This is an opportunity for bigger companies to
implement all company best practises on every new AWS SAM project created from get-go. Be aware of the downside that
changes to template will be applied during `sam init` command. In current project unit tests were adjusted to the
provided code. Best to run from project root folder `python -m pytest sam/tests -v`. Integration tests are generated as
a setup for future test implementation. Test in folder `unit` are using pytest, in folder `integration` are using
unittest library.

During `sam build --guided` configuration file can be created with selected settings (add it to your repository for
versioning). This file is useful to run sam deployment in CICD pipeline.

`sam_README.md` - documentation generated during project initialization.

In case of looking for examples of creating new resources in AWS together with SAM Application - look for CloudFormation
examples in its documentation, there is plenty of there. The AWS CDK is also based on CloudFormations, so they can be
integrated together

Temporary files can be found in `.aws-sam`. There is both deployed lambda - exact code before packaging, template.yaml
with resources description and build.toml with lambda packaging and deployment information. All this information used
when creating CloudFormation stack and uploading lambda artifact.

```bash
#Create deployment
sam init

#Build and Deploy (save samconfig.toml file after deploy, next time use without --guided
sam build --use-container
sam deploy --guided

#Local execution
sam local invoke BpkFunction --event ../test/event.json

#Delete created resources - stack name can be found in samconfig.toml file
aws cloudformation delete-stack --stack-name sam-app
```

PROS:

- documentation is rich
- allows generation of project based on custom or provided template (quite a few to chose from)
- projects generated by default
- integration with numerous IDE
- building application code using container for more reproducible code builds
- local lambda function execution using docker images
- AWS SAM cli provides most tools to develop/test/debug/view logs without a need to go to AWS console
- groups multiple lambdas into application
- application removal does not require AWS SAM cli - stack removal is all that needs to be done
- support both Zip and Image deployment
- swift integration with AWS build tools
- possibility to review what will be deployed and adding approval step
- repository with most commonly used applications, there is a possibility to create private repository to share
  applications inside of company

CONS:

- vendor locking (both cloud provider and IaC tool - CloudFormations)
- enforces standards on lambda (like always create empty requirements.txt if not needed, function naming convention)
- advanced resource customizations has to be written in CloudFormation
- only local lambda execution is a part of AWS SAM cli, for remote call use `lambda invoke --function-name ...`
- slower for bigger deployments

